from typing import Annotated, Any, Dict, List, Literal, NotRequired, Optional, TypedDict, Union, Callable
from langchain.agents import AgentState


class ArtifactDefinition(TypedDict):
    id: int
    name: str
    goal: str
    methodology: str
    criteria: List[str]

class CriteriaEstimation(TypedDict):
    """Estimation of artifact criteria. 
    Высокоуровневая оценка выполнения критерия.
    """
    criteria_estimation: Annotated[str, ..., "Estimation of artifact criteria. Высокоуровневая оценка выполнения критерия.Format as MarkdownV2."]

class ArtifactOption(TypedDict):
    """Option for an artifact. 
    Вариант для артефакта.
    """
    artifact_option: Annotated[str, ..., "Option for an artifact. Вариант для артефакта.Format as MarkdownV2."]
    criteris_estimations: Annotated[List[CriteriaEstimation], ..., "List of estimations for criterias applicable for the aftifact. Перечень оценок выполнения критериев для артефакта."]

class ArtifactOptions(TypedDict):
    """List of options for an artifact.
        Список вариантов для артефакта.
    """
    general_considerations: Annotated[str, ..., "General considerations for an artifact. Общие рассуждения для артефакта. Format as MarkdownV2."]
    artifact_options: Annotated[List[ArtifactOption], ..., "Unnumbered list of options for an artifact. Ненумерованный список вариантов для артефакта."]

class AftifactFinalText(TypedDict):
    """Final text for an artifact.
    Финальный текст для артефакта.
    """
    artifact_final_text: Annotated[str, ..., "Final text for an artifact. Финальный текст для артефакта. Format as MarkdownV2."]

class ArtifactDetails(TypedDict):
    artifact_definition: ArtifactDefinition
    artifact_options: ArtifactOptions
    selected_option: int
    artifact_final_text: str

from enum import IntEnum

class ArtifactState(IntEnum):
    INIT = 0
    OPTIONS_GENERATED = 4
    OPTION_SELECTED = 6
    ARTIFACT_GENERATED = 8
    ARTIFACT_CONFIRMED = 12

class ArtifactAgentState(AgentState[ArtifactOptions]):
    # Merge helpers to allow concurrent writes without InvalidUpdateError
    def _merge_latest(a, b):
        return b if b is not None else a

    def _merge_dict(a: Dict[str, Any] | None, b: Dict[str, Any] | None):
        return {**(a or {}), **(b or {})}

    def _merge_artifacts(a: Dict[int, ArtifactDetails] | None, b: Dict[int, ArtifactDetails] | None):
        return {**(a or {}), **(b or {})}

    user_info: NotRequired[Annotated[Dict[str, Any], _merge_dict]]
    user_prompt: Annotated[str, _merge_latest]
    artifacts: NotRequired[Annotated[Dict[int, ArtifactDetails], _merge_artifacts]]
    current_artifact_id: NotRequired[Annotated[int, _merge_latest]]
    current_artifact_state: NotRequired[Annotated[ArtifactState, _merge_latest]]
    current_artifact_text: Annotated[str, _merge_latest]
    #generated_artifacts: List[ArtifactDetails]
    #selected_option: NotRequired[int]

class ArtifactAgentContext(TypedDict):
    user_prompt: str
    generated_artifacts: List[ArtifactDetails]

def get_artifacts_list()-> str:
    artifact_list = ""
    for artifact in ARTIFACTS:
        artifact_list += f"{artifact['id']+1}: {artifact['name']}\n"
    return artifact_list


ARTIFACTS: List[ArtifactDefinition] = [
    {
        "id": 0,
        "stage": "Генерация идей",
        "stage_goal": "Сформулировать и «упаковать» первоначальную бизнес-идею в понятный формат для её первичной оценки.",
        "name": "Продуктовая троица",
        "goal": "Этот инструмент используется для стратегического анализа и поиска возможностей для кратного, экспоненциального роста («в иксы»). Он помогает убедиться, что ваша идея нацелена на растущий рынок с реальной проблемой",
        "components": [
            "Клиентский сегмент: Поиск агрессивно растущих сегментов.",
            "Проблема (Потребность): Анализ рынка проблем, конкурирующих за внимание сегмента",
            "Ценность: Анализ рынка ценностей, которые решают проблему",
            "Решение: Анализ рынка решений, которые доставляют ценность"
        ],
        "methodology": 
"""Продуктовую троицу.
1.	Начните с любого из трех элементов. Например, найдите быстрорастущий клиентский сегмент (люди, работающие удаленно8; молодые люди, совершающие онлайн-транзакции).
2.	Определите их самую острую, критическую потребность (нехватка «живого» общения).
3.	Сформулируйте ценность, которая решает эту проблему.
4.	Проанализируйте, какие решения могут доставить эту ценность, и ищите экспоненциально растущие драйверы (продукты из данных, дашборды, UBER-изация).
5.	Задавайте себе вопрос: «Где здесь иксы (рост 2x-30x)?». Если кратного роста нет ни в сегменте, ни в проблеме, ни в ценности — ищите дальше
""",
        "criteria": ["Сегмент растущий", "Реальная боль на языке клиента", "Потенциал 2x-30x", "Тезисы проверяемы"]
    },
    {
        "id": 1,
        "stage": "Генерация идей",
        "stage_goal": "Сформулировать и «упаковать» первоначальную бизнес-идею в понятный формат для её первичной оценки.",
        "name": "Карточка инициативы (продуктовый канвас)",
        "goal": "Структурировать и «упаковать» вашу бизнес-идею в единый, понятный формат.",
        "components": [
            "Сегменты клиентов: Конкретные группы пользователей, чью проблему вы решаете.",
            "Проблема: Формулировка боли клиента на его языке",
            "Альтернативные решения: Как клиенты решают проблему сейчас?",
            "Источники прибыли: Модель монетизации. Как вы будете зарабатывать?",
            "Решение: Как именно ваш продукт будет решать проблему?",
            "Каналы коммуникации: Как клиенты узнают о вашем решении?",
            "Ключевые метрики: Как вы будете измерять успех?",
            "Структура затрат: На что потребуются ресурсы?",
            "Бизнес-процессы: Какие внутренние процессы компании будут затронуты?",
        ],
        "methodology": 
"""Заполнить все разделы: проблема, решение, рынок, команда, метрики.
1.	Название: Сделайте его кратким, ёмким и понятным. Оно должно отражать суть.
2.	Сегменты: Будьте конкретны. «Ритейл-клиенты» — плохой сегмент. «Текущие клиенты нашего банка, имеющие дебетовые и кредитные карты» — хороший. Избегайте слишком широких или слишком узких сегментов.
3.	Проблема: Не путайте причину и следствие. «Отсутствие методики» — это не проблема клиента. «Невозможность экспортировать продукцию из-за отсутствия сертификации» — вот его боль. Говорите на языке клиента.
4.	Источники прибыли и Затраты: Сделайте предварительную оценку, покажите порядок цифр. Это ваша гипотеза о P&L.
5.	Метрики: Выбирайте относительные метрики (например, процент успешных авторизаций), а не абсолютные (количество авторизаций). Метрики должны быть связаны с источниками прибыли.
6.	Кросс-аналитика: Постоянно проверяйте связь между блоками. Решает ли ваше «Решение» указанную «Проблему» для данного «Сегмента»? Соответствуют ли «Метрики» вашим «Источникам прибыли»?
""",
        "criteria": ["Все разделы заполнены", "Сегменты конкретны", "Проблема на языке клиента", "Относительные метрики"]
    },
    {
        "id": 2,
        "stage": "Генерация идей",
        "stage_goal": "Сформулировать и «упаковать» первоначальную бизнес-идею в понятный формат для её первичной оценки.",
        "name": "Карта стейкхолдеров",
        "goal": "Идентифицировать всех людей и группы, на которых влияет ваша инициатива или которые могут повлиять на неё. Это помогает выстроить правильную коммуникацию и управлять ожиданиями",
        "components": [
            "Список стейкхолдеров: Все, кто имеет отношение к проекту (топ-менеджмент, команда, юристы, финансы, пользователи и т.д.).",
            "Матрица 'Власть/Интерес': Инструмент для классификации стейкхолдеров\n"
            "-- Высокая власть / Высокий интерес (Ключевые игроки): Управлять плотно.\n"
            "-- Высокая власть / Низкий интерес (Создатели контекста): Держать удовлетворенными.\n"
            "-- Низкая власть / Высокий интерес (Субъекты): Держать в курсе.\n"
            "-- Низкая власть / Низкий интерес (Толпа): Мониторить с минимальными усилиями.",
        ],
        "methodology": 
"""Составляем матрицу влияния/интереса.
1.	Составьте полный список всех, кто может быть заинтересован в вашем проекте или затронут им.
2.	Проанализируйте каждого стейкхолдера, оценив его уровень власти (влияния на проект) и уровень интереса (насколько проект важен для него).
3.	Разместите каждого в соответствующем квадранте матрицы.
4.	Разработайте стратегию коммуникации для каждой группы. Например, с ключевыми игроками нужно взаимодействовать регулярно и вовлекать в принятие решений, а группу "Толпа" достаточно периодически информировать через общие рассылки.
""",
        "criteria": ["Роли/интересы определены", "Влияние оценено", "Риски учтены", "Матрица взаимодействия"]
    },
    {
        "id": 3,
        "stage": "Исследования",
        "stage_goal": "Проверить все гипотезы из «Карточки инициативы» с помощью данных и общения с клиентами. Снизить риски, «убив» нежизнеспособные идеи до начала дорогостоящей разработки.",
        "name": "Бэклог гипотез",
        "goal": "Собрать и приоритизировать все предположения о проблемах, сегментах и решениях для их систематической проверки.",
        "components": [
            "Гипотеза: Сформулированная по принципу «Если..., то...».",
            "Сегмент: Для какой группы пользователей проверяется гипотеза.",
            "Приоритет: Насколько важна эта гипотеза.",
            "Способ проверки: Например, глубинное интервью, A/B тест, прототип.",
        ],
        "methodology": 
"""HADI циклы, приоритезация ICE/RICE.
1.	Перенесите все предположения из «Карточки инициативы» в бэклог.
2.	Сформулируйте их в виде гипотез. Например: "Если мы упростим процедуру регистрации, то процент успешных авторизаций увеличится с 40% до 80%".
3.	Проведите приоритизацию гипотез, чтобы начать с самых рискованных и важных.
""",
        "criteria": ["Формула гипотезы", "Метрика успеха", "Приоритет (ICE/RICE)", "Связь с болью"]
    },
    {
        "id": 4,
        "stage": "Исследования",
        "stage_goal": "Проверить все гипотезы из «Карточки инициативы» с помощью данных и общения с клиентами. Снизить риски, «убив» нежизнеспособные идеи до начала дорогостоящей разработки.",
        "name": "Глубинное интервью (CustDev)",
        "goal": "Получить качественные данные о проблемах, целях и текущем опыте пользователей для проверки гипотез.",
        "components": [
            "Гипотезы: Какие предположения вы проверяете.",
            "Цели интервью: Что конкретно вы хотите узнать.",
            "Структура и вопросы: Подробный скрипт с открытыми вопросами.",
            "Тайминг: Сколько времени отводится на каждый блок.",
        ],
        "methodology": 
"""CustDev, открытые вопросы.
1.	Подготовка — 90% успеха!. Тщательно пропишите план.
2.	Задавайте открытые вопросы о прошлом опыте. Не спрашивайте «Хотели бы вы...?» (форсайтный вопрос). Спрашивайте «Расскажите, как вы в последний раз решали проблему...?» (ретроспективный вопрос).
3.	Используйте правило «5 почему», чтобы докопаться до первопричины.
4.	Внимательно слушайте, не перебивайте. Большую часть времени должен говорить собеседник.
5.	Фиксируйте результаты в виде таблицы инсайтов по каждому респонденту
""",
        "criteria": ["Целевая выборка", "Сценарий", "Инсайты с цитатами", "Ссылки на сырьё"]
    },
    {
        "id": 5,
        "stage": "Исследования",
        "stage_goal": "Проверить все гипотезы из «Карточки инициативы» с помощью данных и общения с клиентами. Снизить риски, «убив» нежизнеспособные идеи до начала дорогостоящей разработки.",
        "name": "Ценностное предложение",
        "goal": "Систематически сопоставить потребности клиента и характеристики вашего продукта, чтобы убедиться в их соответствии и четко сформулировать главную выгоду. Этот артефакт помогает «продать» концепцию продукта клиентам и стейкхолдерам.",
        "components": [
            "Профиль потребителя (Круг):\n"
            "-- Задачи потребителя: Что клиент пытается сделать (функциональные, социальные, эмоциональные)\n"
            "-- Проблемы потребителя: Что его беспокоит и мешает\n"
            "-- Выгоды потребителя: Какие результаты и преимущества он хочет получить",
            "Карта ценности (Квадрат):\n"
            "-- Товары и услуги: Перечень того, что вы предлагаете.\n"
            "-- Факторы помощи (Pain Relievers): Как ваш продукт решает проблемы клиента.\n"
            "-- Факторы выгоды (Gain Creators): Как ваш продукт создает выгоды для клиента.\n",
        ],
        "methodology": 
"""Value Proposition Canvas.
1.	Начните с Профиля потребителя. На основе данных из глубинных интервью заполните задачи, проблемы и выгоды клиента.
2.	Затем заполните Карту ценности. Опишите, как ваш продукт и его функции помогают клиенту, снимая его боли и создавая выгоды.
3.	Найдите соответствие (fit). Убедитесь, что ваши факторы помощи и выгоды нацелены на самые важные проблемы и желаемые выгоды клиента.
4.	Сформулируйте ценностное предложение. Используйте простую формулу: «Наш [продукт] помогает [сегменту клиентов], которые хотят [выполнить задачу], тем, что [устраняет проблему] и [создает выгоду]».
""",
        "criteria": ["Связка боль->выгода", "Top-3 ценности", "Проверяемые обещания"]
    },
    {
        "id": 6,
        "stage": "Исследования",
        "stage_goal": "Проверить все гипотезы из «Карточки инициативы» с помощью данных и общения с клиентами. Снизить риски, «убив» нежизнеспособные идеи до начала дорогостоящей разработки.",
        "name": "Карта путешествия клиента (CJM)",
        "goal": "Визуализировать весь опыт клиента при взаимодействии с компанией или продуктом, чтобы выявить барьеры, болевые точки и негативные эмоции.",
        "components": [
            "Этапы: Ключевые фазы взаимодействия (поиск, покупка, использование).",
            "Действия: Что конкретно делает клиент на каждом этапе.",
            "Точки касания: Где происходит взаимодействие (сайт, приложение, колл-центр).",
            "Проблемы и барьеры: Что мешает клиенту.",
            "Эмоции: Что чувствует клиент на каждом шаге (отображается графиком).",
            "Решения: Идеи по устранению барьеров.",
        ],
        "methodology": 
"""Путь от возникновения потребности до решения.
1.	Соберите информацию: Используйте данные из глубинных интервью.
2.	Опишите персонажа: Создайте собирательный образ вашего клиента.
3.	Нанесите на карту все этапы, действия и точки касания.
4.	Определите барьеры и отметьте, где клиент испытывает негативные эмоции.
5.	Сгенерируйте гипотезы о решениях для устранения этих барьеров.
""",
        "criteria": ["Стадии", "Боли/эмоции", "Точки контакта", "Возможности улучшения"]
    },
    {
        "id": 7,
        "stage": "Исследования",
        "stage_goal": "Проверить все гипотезы из «Карточки инициативы» с помощью данных и общения с клиентами. Снизить риски, «убив» нежизнеспособные идеи до начала дорогостоящей разработки.",
        "name": "Карта бизнес-процессов",
        "goal": "Отразить текущую ситуацию и систематизировать внутренние процессы организации, на которые влияет ваша инициатива. В отличие от CJM, этот артефакт показывает взаимодействие всех внутренних ролей, а не только клиента.",
        "components": [
            "Роли: Все участники процесса (не только клиент).",
            "Действия: Последовательность операций.",
            "Длительность: Время выполнения каждого действия.",
            "Инструменты/Системы: Какие программы или документы используются.",
            "Гипотезы о проблемах и решениях: Где есть «узкие места» и как их можно улучшить.",
        ],
        "methodology": 
"""BPMN или простая схема.
1.	Соберите информацию: Поговорите с бизнес-аналитиками и сотрудниками, вовлеченными в процесс.
2.	Определите точки входа и выхода процесса, чтобы задать четкие границы.
3.	Нанесите на карту все действия, роли и используемые инструменты.
4.	Проанализируйте процесс и зафиксируйте гипотезы о проблемах (например, «оформление печатных форм занимает слишком много времени») и решениях.
""",
        "criteria": ["AS-IS/TO-BE", "Входы/выходы", "Владельцы", "Узкие места"]
    },
    {
        "id": 8,
        "stage": "Исследования",
        "stage_goal": "Проверить все гипотезы из «Карточки инициативы» с помощью данных и общения с клиентами. Снизить риски, «убив» нежизнеспособные идеи до начала дорогостоящей разработки.",
        "name": "Конкурентный анализ",
        "goal": "Понять, как другие компании решают схожие проблемы, чтобы правильно позиционировать свой продукт, избежать чужих ошибок и найти конкурентные преимущества.",
        "components": [
            "Конкуренты: Список прямых и косвенных конкурентов.",
            "Сегменты клиентов: На кого нацелены конкуренты.",
            "Ценностное предложение (УТП): Чем они привлекают клиентов.",
            "Модель монетизации: Как они зарабатывают.",
            "Характеристики продукта: Ключевые фичи.",
            "Цена/стоимость.",
            "Отзывы клиентов.",
        ],
        "methodology": 
"""Сравнение по фичам, ценам, опыту.
1.	Найдите конкурентов: Используйте поиск, данные маркетинга, отраслевые отчеты. Анализируйте не только прямых конкурентов, но и тех, кто борется за ту же клиентскую ценность (например, для микрокредитов конкурентами являются и ломбарды).
2.	Соберите информацию по всем ключевым пунктам и занесите в сравнительную таблицу.
3.	Станьте клиентом конкурента, чтобы изучить его продукт изнутри.
4.	Проанализируйте сильные и слабые стороны и определите, в чем вы можете быть лучше. Не конкурируйте ценой в последнюю очередь!
""",
        "criteria": [">=5 альтернатив", "Сравнительная таблица", "Дифференциация"]
    },
    {
        "id": 9,
        "stage": "Исследования",
        "stage_goal": "Проверить все гипотезы из «Карточки инициативы» с помощью данных и общения с клиентами. Снизить риски, «убив» нежизнеспособные идеи до начала дорогостоящей разработки.",
        "name": "Уникальное торговое предложение (УТП)",
        "goal": "На основе понимания клиента и рынка сформулировать одно ясное, короткое и убедительное предложение, которое объясняет, почему ваш продукт — лучший выбор.",
        "components": [
            "Целевая аудитория: Для кого ваш продукт.",
            "Проблема: Какую боль вы решаете.",
            "Решение/Продукт: Что вы предлагаете.",
            "Уникальное отличие: Что делает вас лучше конкурентов.",
        ],
        "methodology": 
"""Почему купят именно у нас.
1.	Синтезируйте знания: Вернитесь к артефактам «Ценностное предложение» (что нужно клиенту) и «Конкурентный анализ» (что предлагают другие).
2.	Найдите свою уникальность: В чем ваше ключевое преимущество, которое важно для клиента и которое сложно скопировать? Это может быть новая технология, особый сервис, более удобный дизайн и т.д
3.	Сформулируйте УТП: Используйте простую и понятную структуру. Например: "Для [целевой сегмент], которые сталкиваются с [проблема], наш [продукт] предоставляет [ключевое преимущество], в отличие от [конкуренты]".
4.	Проверьте его: Ваше УТП должно быть конкретным, легко запоминающимся и вызывать желание узнать больше.
""",
        "criteria": ["Одна чёткая формула", "Доказуемые преимущества", "Релевантно сегменту"]
    },
    {
        "id": 10,
        "stage": "Проектирование",
        "stage_goal": "На основе проверенных гипотез спроектировать детальное решение, рассчитать его экономику и составить план реализации.",
        "name": "Финансовая модель",
        "goal": "Детально оценить экономический эффект продукта, рассчитав все доходы и расходы, и определить точку безубыточности.",
        "components": [
            "Затраты (расходы)\n"
            "-- Переменные: Команда проекта, внешние подрядчики.\n"
            "-- Постоянные: Поддержка, лицензии.",
            "Доходы (экономический эффект): Рассчитываются на основе ключевых метрик.",
            "Точка безубыточности (TCO - Total Cost of Ownership): Момент, когда доходы начинают превышать расходы.",
        ],
        "methodology": 
"""Unit-экономика, P&L.
1.	Соберите все типы расходов: Команда, подрядчики, оборудование, маркетинг, поддержка и т.д..
2.	Распределите расходы по месяцам в соответствии со стадиями фреймворка.
3.	Рассчитайте доходы: Возьмите ключевые метрики и покажите, как их изменение влияет на деньги. Например, «увеличение конверсии на 10% принесет Х денег».
4.	Постройте три сценария: негативный, стандартный и позитивный.
5.	Определите точку окупаемости. В продуктовом подходе она должна быть в горизонте 3-6 месяцев.
""",
        "criteria": ["Ключевые допущения", "LTV/CAC/маржа", "Чувствительность", "Сценарии"]
    },
    {
        "id": 11,
        "stage": "Проектирование",
        "stage_goal": "На основе проверенных гипотез спроектировать детальное решение, рассчитать его экономику и составить план реализации.",
        "name": "Дорожная карта",
        "goal": "Создать комплексный план работ, визуализирующий основные этапы, задачи и зависимости для координации команды и информирования стейкхолдеров.",
        "components": [
            "Задачи/Пакеты работ: Декомпозиция крупных целей.",
            "Сроки: Длительность выполнения каждой задачи.",
            "Ответственные: Кто выполняет задачу.",
            "Вехи (Milestones): Ключевые события, отмечающие завершение этапа.",
            "Критический путь: Самая длинная цепочка задач, определяющая общую длительность проекта.",
        ],
        "methodology": 
"""План работ.
1.	Определите цели и этапы разработки.
2.	Декомпозируйте их на задачи.
3.	Определите последовательность, длительность и связи между задачами.
4.	Назначьте ответственных.
5.	Установите вехи в конце каждого значимого этапа (например, «Тестирование завершено»).
6.	Управляйте рисками, добавляя временные буферы (резерв времени).
""",
        "criteria": ["Релизы", "Цели/метрики", "Ресурсы/риски", "Вехи"]
    },
    {
        "id": 12,
        "stage": "Проектирование",
        "stage_goal": "На основе проверенных гипотез спроектировать детальное решение, рассчитать его экономику и составить план реализации.",
        "name": "Карточка проекта",
        "goal": "Финальный документ для защиты проекта и получения бюджета на стадию Development. Он объединяет и суммирует всю проделанную работу на предыдущих этапах.",
        "components": [
            "Резюме проекта: Краткое описание решения, подтвержденная проблематика и целевые сегменты.",
            "Описание MVP: Задачи, пилотная зона, метрики успешности.",
            "Экономика: Данные из финансовой модели (доходы, затраты, затраты на команду).",
            "Команда проекта: Роли, компетенции, вовлеченность (FTE).",
            "Риски: Что может пойти не так и как вы планируете это решать.",
        ],
        "methodology": 
"""Summary всего проекта.
1.	Перенесите подтвержденные данные: В отличие от «Карточки инициативы», здесь должны быть только валидированные гипотезы о проблемах и решениях3.
2.	Детально опишите MVP: Что именно вы будете реализовывать, на каком сегменте и по каким метрикам будете оценивать успех.
3.	Интегрируйте финансовую модель: Укажите точные цифры по доходам и расходам.
4.	Представьте команду, необходимую для реализации.
5.	Продумайте риски и предложите способы их митигации.
""",
        "criteria": ["Сводка по 1-12", "Роли/ответственность", "Критерии готовности", "Go/No-Go"]
    }
]


ARTIFACTS_OLD: List[ArtifactDefinition] = [
    {
        "id": 0,
        "name": "Продуктовая троица",
        "goal": "Определить сегмент, проблему и решение.",
        "methodology": "Сегмент должен быть растущим, боль реальной, решение масштабируемым.",
        "criteria": ["Сегмент растущий", "Реальная боль на языке клиента", "Потенциал 2x-30x", "Тезисы проверяемы"]
    },
    {
        "id": 1,
        "name": "Карточка инициативы",
        "goal": "Сформировать паспорт проекта.",
        "methodology": "Заполнить все разделы: проблема, решение, рынок, команда, метрики.",
        "criteria": ["Все разделы заполнены", "Сегменты конкретны", "Проблема на языке клиента", "Относительные метрики"]
    },
    {
        "id": 2,
        "name": "Карта стейкхолдеров",
        "goal": "Определить всех заинтересованных лиц и их влияние.",
        "methodology": "Матрица влияния/интереса.",
        "criteria": ["Роли/интересы определены", "Влияние оценено", "Риски учтены", "Матрица взаимодействия"]
    },
    {
        "id": 3,
        "name": "Бэклог гипотез",
        "goal": "Собрать список гипотез для проверки.",
        "methodology": "HADI циклы, приоритезация ICE/RICE.",
        "criteria": ["Формула гипотезы", "Метрика успеха", "Приоритет (ICE/RICE)", "Связь с болью"]
    },
    {
        "id": 4,
        "name": "Глубинное интервью",
        "goal": "Подтвердить проблему через интервью.",
        "methodology": "CustDev, открытые вопросы.",
        "criteria": ["Целевая выборка", "Сценарий", "Инсайты с цитатами", "Ссылки на сырьё"]
    },
    {
        "id": 5,
        "name": "Ценностное предложение",
        "goal": "Сформулировать выгоду для клиента.",
        "methodology": "Value Proposition Canvas.",
        "criteria": ["Связка боль->выгода", "Top-3 ценности", "Проверяемые обещания"]
    },
    {
        "id": 6,
        "name": "Карта путешествия клиента (CJM)",
        "goal": "Визуализировать путь клиента.",
        "methodology": "Путь от возникновения потребности до решения.",
        "criteria": ["Стадии", "Боли/эмоции", "Точки контакта", "Возможности улучшения"]
    },
    {
        "id": 7,
        "name": "Карта бизнес-процессов",
        "goal": "Описать процессы AS-IS и TO-BE.",
        "methodology": "BPMN или простая схема.",
        "criteria": ["AS-IS/TO-BE", "Входы/выходы", "Владельцы", "Узкие места"]
    },
    {
        "id": 8,
        "name": "Конкурентный анализ",
        "goal": "Сравнить с конкурентами.",
        "methodology": "Сравнение по фичам, ценам, опыту.",
        "criteria": [">=5 альтернатив", "Сравнительная таблица", "Дифференциация"]
    },
    {
        "id": 9,
        "name": "УТП",
        "goal": "Сформулировать Уникальное Торговое Предложение.",
        "methodology": "Почему купят именно у нас.",
        "criteria": ["Одна чёткая формула", "Доказуемые преимущества", "Релевантно сегменту"]
    },
    {
        "id": 10,
        "name": "Финансовая модель",
        "goal": "Оценить экономику проекта.",
        "methodology": "Unit-экономика, P&L.",
        "criteria": ["Ключевые допущения", "LTV/CAC/маржа", "Чувствительность", "Сценарии"]
    },
    {
        "id": 11,
        "name": "Дорожная карта",
        "goal": "План реализации.",
        "methodology": "Gantt или список релизов.",
        "criteria": ["Релизы", "Цели/метрики", "Ресурсы/риски", "Вехи"]
    },
    {
        "id": 12,
        "name": "Карточка проекта",
        "goal": "Финальная сводка.",
        "methodology": "Summary всего проекта.",
        "criteria": ["Сводка по 1-12", "Роли/ответственность", "Критерии готовности", "Go/No-Go"]
    }
]
